---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library("hdxstats")
library("dplyr")
library("ggplot2")
library("RColorBrewer")
library("tidyr")
library("pheatmap")
library("scales")
library("viridis")
library("patchwork")
library("Biostrings")
library("xfun")
```

```{r}
data_filepath <- "vignettes/data/MBPqDF.rsd"
hdx_data <- extract_hdx_data(data_filepath) # DONE


# TEST 1
# INPUT
data_selection <- hdx_data[,1:24]
all_peptides <- rownames(data_selection)[[1]]
starting_parameters <- list(a = NULL, b = 0.001,  d = NULL, p = 1)
# OUTPUT
results <- analyse_kinetics(data = data_selection, 
                            method = "fit", 
                            peptide_selection = all_peptides, 
                            start = starting_parameters)
```

```{r}
results$method
```


```{r, fig.width= 22, fig.height = 10}
graphics_kinetic <- visualise_hdx_data(results, type="kinetics") 
graphics_kinetic[[1]] | graphics_kinetic[[2]] | graphics_kinetic[[3]]
```



```{r, fig.width= 22, fig.height = 10}
graphics <- visualise_hdx_data(results, type="forest") 
```


```{r, fig.width= 22, fig.height = 10}
graphics[[1]] | graphics_kinetic[[1]]
```

```{r}
graphics[[1]]$data
```

```{r}
data_selection <- hdx_data[,1:100]
all_peptides <- rownames(data_selection)[[1]] # get all peptides
starting_parameters <- list(a = NULL, b = 0.0001,  d = NULL, p = 1)
# OUTPUT
results <- analyse_kinetics(data = data_selection, 
                            method = "dfit", 
                            peptide_selection = all_peptides[37], 
                            start = starting_parameters)

```

```{r}
graphics <- visualise_hdx_data(results, type="kinetics")
```
```{r}
graphics
```


```{r}
head(HOIP)
colnames(HOIP)
```

EXAMPLE: Tutorial 1

```{r}
csv_filename <- "MBP.csv"
csv_filepath <- system.file("extdata", csv_filename, package = "hdxstats")
data <- read.csv(csv_filepath)

columns_names <- c("hx_time", "replicate_cnt", "hx_sample") # to merge into new column names
columns_fixed <- c("pep_sequence", "pep_charge")

# transform data
data_wide <- pivot_wider(data.frame(data),
                        values_from = d,  # Deu_Uptake
                        names_from = columns_names, # Exposure_Time, Replicate, Other
                        id_cols = columns_fixed) # Sequence, Charge
                        

```

EXAMPLE: Tutorial 3 (HOIP)

```{r}
HOIPpath <- system.file("extdata", "N64184_1a2_state.csv", package = "hdxstats")
HOIP <- read.csv(HOIPpath)

HOIP_wide <- pivot_wider(data.frame(HOIP),
                         values_from = Center, # Deu_Uptake
                         names_from = c("Exposure", "State"), # Exposure_Time, State
                         id_cols = c("Sequence")) # Sequence

```

EXAMPLE: Case study

```{r}
secA <- read.csv("inst/extdata/Project_2_SecA_Cluster_Data.csv")

secA_wide <- pivot_wider(data.frame(secA),
                        values_from = "Center",  # Deu_Uptake
                        names_from = c("Exposure", "File", "State"), # Exposure_Time, Other, State
                        id_cols = c("Sequence", "z")) # Sequence, Charge

```