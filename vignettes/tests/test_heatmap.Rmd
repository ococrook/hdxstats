---
title: "R Notebook"
output: html_notebook
---

```{r}
library("RColorBrewer")
library("scales")
library("pheatmap")
```

```{r}

averaged_protection <- read.csv("../data/averaged_protection_both.csv")
antibody_selection <- colnames(averaged_protection)[c(2:length(averaged_protection))]

heatmap_data <- list()

for (antibody in antibody_selection) {
  filename_csv <- paste("../data/hdx_", antibody, "_labelled_residues_pdb_5edv_chainA.csv", sep="")
  df <- data.frame(read.csv(filename_csv))
  
  hdx_values <- c()
  for (i in seq(length(df$aa))){
    if (df$labels[i] == "deprotected") {
      hdx_values <- append(hdx_values, -1*df$hdx_values[i])
    } else{
      hdx_values <- append(hdx_values, df$hdx_values[i])
    }
  }
  heatmap_data[[antibody]] <- hdx_values
}


heatmap_matrix <- matrix(unlist(heatmap_data), nrow = 245)
colnames(heatmap_matrix) <- antibody_selection
rownames(heatmap_matrix) <- df$aa
```


```{r}
pheatmap(t(heatmap_matrix),
         color=colorRampPalette(rev(brewer.pal(n=7, name="RdBu")))(100),
         #color=color_function(heatmap_matrix),
         cluster_rows=FALSE, 
         cluster_cols=FALSE,
         cellwidth=7.5, 
         cellheight=7.5,
         fontsize=6.5,
         res=100,
         filename="heatmap_all_average_hdx_data.png"
         )
```
